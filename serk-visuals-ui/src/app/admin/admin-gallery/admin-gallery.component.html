<section class="container section">
  <header class="head">
    <h1>Admin Gallery</h1>

    <div class="tabs" role="tablist" aria-label="Albums">
      <button
        class="tab"
        [class.is-active]="!album()"
        (click)="setAlbum('')"
        type="button"
        role="tab"
        aria-selected="{{ !album() }}"
      >
        All
      </button>

      <button
        class="tab"
        *ngFor="let a of albums"
        [class.is-active]="album() === a"
        (click)="setAlbum(a)"
        type="button"
        role="tab"
        aria-selected="{{ album() === a }}"
      >
        {{ a | titlecase }}
      </button>
    </div>
  </header>

  <!-- Create / Edit -->
  <form class="card" (ngSubmit)="submit()" [formGroup]="form" novalidate>
    <h2 class="card__title">{{ editingId() ? 'Edit item' : 'Add new item' }}</h2>

    <div class="grid form-grid">
      <label>
        <span class="lbl">Title</span>
        <input formControlName="title" placeholder="Title" />
      </label>

      <label>
        <span class="lbl">Album</span>
        <select formControlName="album">
          <option *ngFor="let a of albums" [value]="a">{{ a | titlecase }}</option>
        </select>
      </label>

      <label class="full">
        <span class="lbl">Tags (comma separated)</span>
        <input formControlName="tags" placeholder="wedding, outdoor, night" />
      </label>

      <label class="switch">
        <input type="checkbox" formControlName="published" />
        <span>Published</span>
      </label>

      <label class="file">
        <span class="lbl">Image (required on create)</span>
        <input id="image" type="file" accept="image/*" (change)="onFile('image', $event)" />
      </label>

      <label class="file">
        <span class="lbl">Thumbnail (optional)</span>
        <input id="thumb" type="file" accept="image/*" (change)="onFile('thumb', $event)" />
      </label>
    </div>

    <div class="actions">
      <button type="submit" class="btn primary">
        {{ editingId() ? 'Update' : 'Create' }}
      </button>
      <button type="button" class="btn" (click)="cancelEdit()" *ngIf="editingId()">Cancel</button>
    </div>
  </form>

  <div class="skeleton" *ngIf="loading()">Loading…</div>
  <div class="alert alert--error" *ngIf="!loading() && error()">{{ error() }}</div>

  <div class="grid-list" *ngIf="!loading() && !error()">
    <article class="tile" *ngFor="let it of items(); trackBy: trackById">
      <img [src]="it.thumbnail || it.url" [alt]="it.title" />
      <div class="tile__body">
        <h4 class="tile__title">{{ it.title }}</h4>
        <p class="muted">
          {{ it.album | titlecase }}
          <ng-container *ngIf="(it.tags?.length ?? 0) > 0">
            · {{ it.tags!.join(', ') }}
          </ng-container>
          <ng-container *ngIf="it.published === false">
            · <span class="badge">Unpublished</span>
          </ng-container>
        </p>
        <div class="tile__actions">
          <button class="btn sm" (click)="edit(it)">Edit</button>
          <button class="btn sm danger" (click)="remove(it)">Delete</button>
        </div>
      </div>
    </article>
  </div>

  <nav class="pager" *ngIf="!loading() && pages() > 1" aria-label="Pagination">
    <button class="btn" [disabled]="page()===1" (click)="goto(page()-1)">Prev</button>
    <span>Page {{ page() }} of {{ pages() }}</span>
    <button class="btn" [disabled]="page()===pages()" (click)="goto(page()+1)">Next</button>
  </nav>
</section>
