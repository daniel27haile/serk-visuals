<section class="gallery">
  <h1>Gallery</h1>

  <!-- Frosted, scrollable, pill tabs -->
  <div
    class="tabs tabs--frosted"
    [class.can-left]="canScrollLeft()"
    [class.can-right]="canScrollRight()"
  >
    <button
      class="tabs__chev tabs__chev--left"
      type="button"
      aria-label="Scroll tabs left"
      [disabled]="!canScrollLeft()"
      (click)="scrollTabs('left')"
    >‹</button>

    <div
      #tabWrap
      class="tabs__wrap"
      role="tablist"
      aria-label="Gallery filters"
      (scroll)="onTabsScroll()"
    >
      <button
        class="tab"
        [class.is-active]="!album()"
        (click)="setAlbum('')"
        role="tab"
        [attr.aria-selected]="(!album()).toString()"
      >
        <span class="tab__icon">⭐</span>
        <span class="tab__label">All</span>
      </button>

      <button
        class="tab"
        *ngFor="let a of albums"
        [class.is-active]="album() === a"
        (click)="setAlbum(a)"
        role="tab"
        [attr.aria-selected]="(album() === a).toString()"
      >
        <span class="tab__icon">{{ albumIcon(a) }}</span>
        <span class="tab__label">{{ a }}</span>
      </button>
    </div>

    <button
      class="tabs__chev tabs__chev--right"
      type="button"
      aria-label="Scroll tabs right"
      [disabled]="!canScrollRight()"
      (click)="scrollTabs('right')"
    >›</button>
  </div>

  <!-- Grid -->
  <div class="gallery__grid">
    <article class="gallery__item" *ngFor="let it of (items() ?? []); trackBy: trackById; let i = index">
      <div class="thumb">
        <img
          class="zoomable"
          [src]="it.thumbnail || it.url"
          [alt]="it.title"
          loading="lazy"
          (click)="openLightbox(i)"
        />
        <div class="thumb__overlay"></div>
      </div>
      <div class="gallery__item-body">
        <h4 [attr.title]="it.title">{{ it.title }}</h4>
        <p class="muted" [attr.title]="joinTags(it.tags) || null">
          {{ it.album }}
          <ng-container *ngIf="(it.tags?.length ?? 0) > 0">
            · {{ joinTags(it.tags) }}
          </ng-container>
        </p>
      </div>
    </article>
  </div>

  <p class="hint" *ngIf="error()">{{ error() }}</p>
  <p class="hint" *ngIf="!error() && ((items()?.length ?? 0) === 0)">No items.</p>

  <nav class="pager" *ngIf="pages() > 1">
    <button [disabled]="page()===1" (click)="goto(page()-1)">Prev</button>
    <span>Page {{ page() }} of {{ pages() }}</span>
    <button [disabled]="page()===pages()" (click)="goto(page()+1)">Next</button>
  </nav>
</section>

<!-- LIGHTBOX -->
<div
  *ngIf="lightboxOpen()"
  id="lb-root"
  class="lightbox-backdrop"
  role="dialog"
  aria-modal="true"
  [attr.aria-label]="'Image preview'"
  tabindex="0"
  (click)="closeLightbox()"
  (keydown)="onLightboxKey($event)"
>
  <div class="lightbox" (click)="$event.stopPropagation()">
    <button class="lb-close" type="button" aria-label="Close" (click)="closeLightbox()">×</button>
    <button class="lb-nav prev" type="button" aria-label="Previous image" (click)="lbPrev()">‹</button>
    <button class="lb-nav next" type="button" aria-label="Next image" (click)="lbNext()">›</button>

    <ng-container *ngIf="lbCurr() as curr">
      <img class="lb-img" [src]="curr.url" [alt]="curr.title" />
      <div class="lb-caption">
        <span class="title">{{ curr.title }}</span>
        <span class="count">{{ lightboxIdx() + 1 }} / {{ items().length }}</span>
      </div>
    </ng-container>
  </div>
</div>
