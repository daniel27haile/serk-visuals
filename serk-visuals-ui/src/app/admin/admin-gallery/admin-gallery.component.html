<section class="container section">
  <header class="head">
    <h1>Admin Gallery</h1>
    <div class="tabs" role="tablist">
      <!-- "All" tab -->
      <button
        class="tab"
        [class.is-active]="!album()"
        (click)="setAlbum('')"
        role="tab"
        [attr.aria-selected]="(!album()).toString()"
      >
        All
      </button>

      <!-- Dynamic tabs -->
      <button
        *ngFor="let a of albums"
        class="tab"
        [class.is-active]="album() === a"
        (click)="setAlbum(a)"
        role="tab"
        [attr.aria-selected]="(album() === a).toString()"
      >
        {{ a | titlecase }}
      </button>
    </div>
  </header>

  <!-- Create / Edit -->
  <form class="card" (ngSubmit)="submit()" [formGroup]="form" novalidate>
    <h2>{{ editingId() ? 'Edit item' : 'Add new item' }}</h2>

    <div class="grid">
      <label>
        Title
        <input formControlName="title" placeholder="Title" />
      </label>

      <label>
        Album
        <select formControlName="album">
          <option *ngFor="let a of albums" [value]="a">{{ a | titlecase }}</option>
        </select>
      </label>

      <label>
        Tags (comma separated)
        <input formControlName="tags" placeholder="wedding, outdoor, night" />
      </label>

      <label class="switch">
        <input type="checkbox" formControlName="published" />
        <span>Published</span>
      </label>

      <label class="file">
        Image (required on create)
        <input
          id="image"
          type="file"
          accept="image/*"
          (change)="onFile('image', $event)"
        />
      </label>

      <label class="file">
        Thumbnail (optional)
        <input
          id="thumb"
          type="file"
          accept="image/*"
          (change)="onFile('thumb', $event)"
        />
      </label>
    </div>

    <div class="actions">
      <button type="submit">{{ editingId() ? 'Update' : 'Create' }}</button>
      <button type="button" (click)="cancelEdit()" *ngIf="editingId()">Cancel</button>
    </div>
  </form>

  <!-- States -->
  <div class="skeleton" *ngIf="loading()">Loading…</div>
  <div class="alert alert--error" *ngIf="!loading() && error()">{{ error() }}</div>

  <!-- Grid -->
  <div class="grid-list" *ngIf="!loading() && !error()">
    <article class="tile" *ngFor="let it of items(); trackBy: trackById">
      <img [src]="it.thumbnail || it.url" [alt]="it.title" />
      <div class="tile__body">
        <h4>{{ it.title }}</h4>
        <p class="muted">
          {{ it.album | titlecase }}
          <ng-container *ngIf="(it.tags?.length ?? 0) > 0">
            · {{ it.tags!.join(', ') }}
          </ng-container>
          <ng-container *ngIf="it.published === false">
            · <span class="badge">Unpublished</span>
          </ng-container>
        </p>
        <div class="tile__actions">
          <button (click)="edit(it)">Edit</button>
          <button class="danger" (click)="remove(it)">Delete</button>
        </div>
      </div>
    </article>
  </div>

  <!-- Pager -->
  <nav class="pager" *ngIf="!loading() && pages() > 1" aria-label="Pagination">
    <button [disabled]="page()===1" (click)="goto(page()-1)">Prev</button>
    <span>Page {{ page() }} of {{ pages() }}</span>
    <button [disabled]="page()===pages()" (click)="goto(page()+1)">Next</button>
  </nav>
</section>
