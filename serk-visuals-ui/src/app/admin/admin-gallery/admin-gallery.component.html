<section class="container section gallery-admin">
  <header class="head">
    <h1 class="title">
      <span>Admin Gallery</span>
      <i aria-hidden="true"></i>
    </h1>

    <div class="tabs" role="tablist">
      <button
        class="tab"
        [class.is-active]="!album()"
        (click)="setAlbum('')"
        role="tab"
        [attr.aria-selected]="(!album()).toString()"
      >
        <span class="dot"></span>
        All
      </button>

      <button
        *ngFor="let a of albums"
        class="tab"
        [class.is-active]="album() === a"
        (click)="setAlbum(a)"
        role="tab"
        [attr.aria-selected]="(album() === a).toString()"
      >
        <span class="dot"></span>
        {{ a | titlecase }}
      </button>
    </div>
  </header>

  <!-- Create / Edit -->
  <form class="card fancy" (ngSubmit)="submit()" [formGroup]="form" novalidate>
    <h2 class="card__title">
      <span class="sparkle" aria-hidden="true">✦</span>
      {{ editingId() ? 'Edit item' : 'Add new item' }}
    </h2>

    <div class="grid form-grid">
      <label>
        <span class="lbl">Title</span>
        <input formControlName="title" placeholder="Title" />
      </label>

      <label>
        <span class="lbl">Album</span>
        <select formControlName="album">
          <option *ngFor="let a of albums" [value]="a">{{ a | titlecase }}</option>
        </select>
      </label>

      <label>
        <span class="lbl">Placement</span>
        <select formControlName="placement">
          <option value="gallery">Gallery</option>
          <option value="slider">Slider (Landing)</option>
          <option value="featured">Featured Gallery (Landing)</option>
        </select>
      </label>

      <label>
        <span class="lbl">Order (for slider/featured)</span>
        <input type="number" formControlName="order" min="0" />
      </label>

      <label class="full">
        <span class="lbl">Tags (comma separated)</span>
        <input formControlName="tags" placeholder="wedding, outdoor, night" />
      </label>

      <label class="switch">
        <input type="checkbox" formControlName="published" />
        <span class="toggle"></span>
        <span class="lbl">Published</span>
      </label>

      <label class="file">
        <span class="lbl">Image (required on create)</span>
        <input id="image" type="file" accept="image/*" (change)="onFile('image', $event)" />
      </label>

      <label class="file">
        <span class="lbl">Thumbnail (optional)</span>
        <input id="thumb" type="file" accept="image/*" (change)="onFile('thumb', $event)" />
      </label>
    </div>

    <div class="actions">
      <button class="btn primary" type="submit">
        {{ editingId() ? 'Update' : 'Create' }}
      </button>
      <button class="btn ghost" type="button" (click)="cancelEdit()" *ngIf="editingId()">Cancel</button>
    </div>
  </form>

  <div class="skeleton" *ngIf="loading()">
    <div class="shimmer"></div>
    Loading…
  </div>

  <div class="alert alert--error" *ngIf="!loading() && error()">{{ error() }}</div>

  <div class="grid-list" *ngIf="!loading() && !error()">
    <article class="tile" *ngFor="let it of items(); trackBy: trackById">
      <div class="media">
        <img [src]="it.thumbnail || it.url" [alt]="it.title" />
        <div class="overlay">
          <div class="overlay__actions">
            <button class="btn sm primary" (click)="edit(it)">Edit</button>
            <button class="btn sm danger" (click)="remove(it)">Delete</button>
          </div>
        </div>
      </div>

      <div class="tile__body">
        <h4 class="tile__title clamp-2" [title]="it.title">{{ it.title }}</h4>
        <p class="muted">
          <span class="chip">{{ it.album | titlecase }}</span>
          <ng-container *ngIf="(it.tags?.length ?? 0) > 0">
            <span class="chip alt">{{ it.tags!.join(', ') }}</span>
          </ng-container>
          <ng-container *ngIf="it.placement">
            <span class="chip tone">{{ it.placement }}</span>
          </ng-container>
          <ng-container *ngIf="it.order !== null && it.order !== undefined">
            <span class="chip tone">#{{ it.order }}</span>
          </ng-container>
          <ng-container *ngIf="it.published === false">
            <span class="chip warn">Unpublished</span>
          </ng-container>
        </p>

        <div class="tile__actions">
          <button class="btn sm" (click)="edit(it)">Edit</button>
          <button class="btn sm danger" (click)="remove(it)">Delete</button>
        </div>
      </div>
    </article>
  </div>

  <nav class="pager" *ngIf="!loading() && pages() > 1" aria-label="Pagination">
    <button class="btn ghost" [disabled]="page()===1" (click)="goto(page()-1)">‹ Prev</button>
    <span>Page <strong>{{ page() }}</strong> of <strong>{{ pages() }}</strong></span>
    <button class="btn ghost" [disabled]="page()===pages()" (click)="goto(page()+1)">Next ›</button>
  </nav>
</section>
